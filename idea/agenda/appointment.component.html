<ion-header class="ion-no-border">
  <ion-toolbar class="ideaToolbar">
    <ion-title>
      {{
        (appointment.appointmentId ? 'IDEA.AGENDA.APPOINTMENT.APPOINTMENT' : 'IDEA.AGENDA.APPOINTMENT.NEW_APPOINTMENT')
          | translate
      }}
      <ion-text *ngIf="!userCanEdit">({{ ('IDEA.AGENDA.APPOINTMENT.READ_ONLY' | translate).toLowerCase() }})</ion-text>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button *ngIf="appointment.appointmentId && userCanEdit" [title]="t._('COMMON.DELETE')" (click)="delete()">
        <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button [title]="t._('COMMON.CLOSE')" (click)="close()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <ion-list [class.viewMode]="!userCanEdit">
    <ion-list-header *ngIf="calendar.external && appointment.linkToOrigin">
      <ion-label></ion-label>
      <ion-button (click)="extBrowser.openLink(appointment.linkToOrigin)">
        {{ 'IDEA.AGENDA.APPOINTMENT.OPEN_IN' | translate }}
        <ion-icon [name]="getServiceIcon()" slot="end"></ion-icon>
      </ion-button>
    </ion-list-header>
    <ion-item
      *ngIf="userCanSeeDetails"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('title')"
    >
      <ion-label position="stacked">
        {{ 'IDEA.AGENDA.APPOINTMENT.TITLE' | translate }}
      </ion-label>
      <ion-input
        type="text"
        [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.TITLE_HINT')"
        [disabled]="!userCanEdit"
        [(ngModel)]="appointment.title"
      ></ion-input>
    </ion-item>
    <ion-item
      *ngIf="userCanSeeDetails"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('location')"
    >
      <ion-label position="stacked">
        {{ 'IDEA.AGENDA.APPOINTMENT.LOCATION' | translate }}
      </ion-label>
      <ion-input
        type="text"
        [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.LOCATION_HINT')"
        [disabled]="!userCanEdit"
        [(ngModel)]="appointment.location"
      ></ion-input>
    </ion-item>
    <ion-item [lines]="userCanEdit ? 'full' : 'inset'" [class.fieldHasError]="hasFieldAnError('allDay')">
      <ion-label>
        {{ 'IDEA.AGENDA.APPOINTMENT.ALL_DAY' | translate }}
      </ion-label>
      <ion-checkbox
        [title]="t._('IDEA.AGENDA.APPOINTMENT.ALL_DAY_HINT')"
        [disabled]="!userCanEdit"
        [(ngModel)]="appointment.allDay"
      ></ion-checkbox>
    </ion-item>
    <idea-date-time
      [label]="t._('IDEA.AGENDA.APPOINTMENT.START_TIME')"
      [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.START_TIME_HINT')"
      [date]="appointment.startTime"
      [timePicker]="!appointment.allDay"
      [disabled]="!userCanEdit"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('startTime')"
      (select)="appointment.startTime = $event"
    ></idea-date-time>
    <idea-date-time
      [label]="t._('IDEA.AGENDA.APPOINTMENT.END_TIME')"
      [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.END_TIME_HINT')"
      [date]="appointment.endTime"
      [timePicker]="!appointment.allDay"
      [disabled]="!userCanEdit"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('endTime')"
      (select)="appointment.endTime = $event"
    ></idea-date-time>
    <idea-select
      [data]="calendarsSuggestions"
      [label]="t._('IDEA.AGENDA.APPOINTMENT.CALENDAR')"
      [description]="calendar.name"
      [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.CALENDAR_HINT')"
      [searchPlaceholder]="t._('IDEA.AGENDA.APPOINTMENT.CALENDAR_HINT')"
      [hideIdFromUI]="true"
      [avoidAutoSelection]="true"
      [disabled]="appointment.appointmentId && !userCanEdit"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('calendarId')"
      (select)="$event ? setCalendar($event.value) : null"
    ></idea-select>
    <ion-item
      *ngIf="userCanSeeDetails"
      [lines]="userCanEdit ? 'full' : 'inset'"
      [class.fieldHasError]="hasFieldAnError('description')"
    >
      <ion-label position="stacked">
        {{ 'IDEA.AGENDA.APPOINTMENT.DESCRIPTION' | translate }}
      </ion-label>
      <ion-textarea
        [rows]="3"
        [placeholder]="t._('IDEA.AGENDA.APPOINTMENT.DESCRIPTION_HINT')"
        [disabled]="!userCanEdit"
        [(ngModel)]="appointment.description"
      ></ion-textarea>
    </ion-item>
  </ion-list>
</ion-content>
<ion-footer *ngIf="userCanEdit">
  <ion-toolbar class="ideaToolbar tappable" [title]="t._('COMMON.SAVE')" (click)="save()">
    <ion-title class="ion-text-center">
      <ion-icon name="checkmark"></ion-icon>
    </ion-title>
  </ion-toolbar>
</ion-footer>
