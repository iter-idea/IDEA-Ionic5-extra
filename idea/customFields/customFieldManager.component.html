<ion-header>
  <ion-toolbar class="ideaToolbar">
    <ion-title>
      {{ 'IDEA.CUSTOM_FIELDS.MANAGE_FIELD' | translate }}
    </ion-title>
    <ion-buttons slot="end">
      <ion-button [title]="t._('IDEA.CUSTOM_FIELDS.CLOSE_WITHOUT_SAVING')" (click)="close()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-list class="ion-padding">
    <ion-row
      class="languageSelector ion-justify-content-center ion-align-items-end"
      *ngIf="languages.default && languages.available.length > 1"
    >
      <ion-col
        size="1"
        class="ion-text-center tappable"
        *ngFor="let l of languages.available"
        [class.current]="l === currentLanguage"
        (click)="currentLanguage = l"
      >
        <img [src]="'assets/flags/' + l + '.png'" />
      </ion-col>
    </ion-row>
    <ion-item lines="inset" [class.fieldHasError]="hasFieldAnError('name')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.NAME' | translate }}
      </ion-label>
      <ion-input
        type="text"
        [value]="theField.name[currentLanguage]"
        [placeholder]="theField.name[languages.default]"
        (ionChange)="theField.name[currentLanguage] = $event.detail.value"
      ></ion-input>
    </ion-item>
    <ion-item lines="inset" [class.fieldHasError]="hasFieldAnError('description')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.DESCRIPTION' | translate }}
        ({{ ('IDEA.CUSTOM_FIELDS.OPTIONAL' | translate).toLowerCase() }})
      </ion-label>
      <ion-input
        type="text"
        [value]="theField.description[currentLanguage]"
        [placeholder]="theField.description[languages.default]"
        (ionChange)="theField.description[currentLanguage] = $event.detail.value"
      ></ion-input>
    </ion-item>
    <ion-item lines="inset" [class.fieldHasError]="hasFieldAnError('type')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.TYPE' | translate }}
      </ion-label>
      <ion-select [(ngModel)]="theField.type">
        <ion-select-option *ngFor="let t of FIELD_TYPES" [value]="t">
          {{ 'IDEA.CUSTOM_FIELDS.FIELDS_TYPES.' + t | translate }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item lines="inset" *ngIf="theField.type == 'ENUM'" [class.fieldHasError]="hasFieldAnError('enum')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.ENUM' | translate }}
      </ion-label>
      <ion-input type="text" readonly="true" [value]="getEnumAsString()"></ion-input>
      <ion-button slot="end" fill="clear" (click)="openEnumList()">
        {{ 'COMMON.EDIT' | translate }}
      </ion-button>
    </ion-item>
    <ion-item lines="inset" *ngIf="theField.type !== 'BOOLEAN'" [class.fieldHasError]="hasFieldAnError('default')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.DEFAULT' | translate }}
        ({{ ('IDEA.CUSTOM_FIELDS.OPTIONAL' | translate).toLowerCase() }})
      </ion-label>
      <ion-input type="text" [(ngModel)]="theField.default"></ion-input>
    </ion-item>
    <ion-item lines="inset" [class.fieldHasError]="hasFieldAnError('min')" *ngIf="theField.type == 'NUMBER'">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.MIN' | translate }}
        ({{ ('IDEA.CUSTOM_FIELDS.OPTIONAL' | translate).toLowerCase() }})
      </ion-label>
      <ion-input type="number" [(ngModel)]="theField.min"></ion-input>
    </ion-item>
    <ion-item lines="inset" [class.fieldHasError]="hasFieldAnError('max')" *ngIf="theField.type == 'NUMBER'">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.MAX' | translate }}
        ({{ ('IDEA.CUSTOM_FIELDS.OPTIONAL' | translate).toLowerCase() }})
      </ion-label>
      <ion-input type="number" [(ngModel)]="theField.max"></ion-input>
    </ion-item>
    <ion-item lines="inset" *ngIf="theField.type !== 'BOOLEAN'" [class.fieldHasError]="hasFieldAnError('obligatory')">
      <ion-label position="stacked">
        {{ 'IDEA.CUSTOM_FIELDS.OBLIGATORY' | translate }}
      </ion-label>
      <ion-select [(ngModel)]="theField.obligatory">
        <ion-select-option [value]="false">
          {{ 'COMMON.NO' | translate }}
        </ion-select-option>
        <ion-select-option [value]="true">
          {{ 'COMMON.YES' | translate }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-row>
      <ion-col class="ion-text-right ion-padding">
        <ion-button [title]="t._('IDEA.CUSTOM_FIELDS.UPDATE_FIELD')" (click)="save()">
          {{ 'IDEA.CUSTOM_FIELDS.SAVE' | translate }}
          <ion-icon slot="end" name="checkmark"></ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-list>
</ion-content>
